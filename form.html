<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form FAQ - WOM Finance</title>
    <link rel="icon" href="wom-finance.jpg" type="image/png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.2/dist/sweetalert2.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <div class="container py-3">
      <h1 class="mb-4 text-center">Form FAQ - WOM Finance</h1>
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0 small">Isi Form FAQ</h5>
        </div>
        <div class="card-body">
          <form id="faqForm" method="POST" novalidate>
            <div class="row mb-2">
              <div class="col-md-6">
                <label for="brand" class="form-label small text-muted"
                  >Brand</label
                >
                <select id="brand" class="form-select form-select-sm" required>
                  <option value="">-- Pilih Brand --</option>
                  <option value="nb">Reguler</option>
                  <option value="mas">MasKu</option>
                  <option value="mtr">MotorKu</option>
                  <option value="mbl">MobilKu</option>
                </select>
                <div class="invalid-feedback">Brand harus dipilih!</div>
              </div>
              <div class="col-md-6">
                <label for="errorSystem" class="form-label small text-muted"
                  >Error Sistem</label
                >
                <select
                  id="errorSystem"
                  name="entry.900671353"
                  class="form-select form-select-sm"
                >
                  <option value="">-- Pilih Error Sistem --</option>
                  <option value="ki">KI</option>
                  <option value="mss">MSS</option>
                  <option value="wise">WISE</option>
                  <option value="login">Login</option>
                </select>
                <div class="invalid-feedback">Error Sistem harus dipilih!</div>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label for="region" class="form-label small text-muted"
                  >Region</label
                >
                <select
                  id="region"
                  name="entry.453750574"
                  class="form-select form-select-sm"
                >
                  <option value="">-- Pilih Region --</option>
                </select>
                <div class="invalid-feedback">Region harus dipilih!</div>
              </div>
              <div class="col-md-6">
                <label for="cabang" class="form-label small text-muted"
                  >Cabang</label
                >
                <select
                  id="cabang"
                  name="entry.27483305"
                  class="form-select form-select-sm"
                >
                  <option value="">-- Pilih Cabang --</option>
                </select>
                <div class="invalid-feedback">Cabang harus dipilih!</div>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label for="NCust" class="form-label small text-muted"
                  >Nama Cust</label
                >
                <input
                  type="text"
                  id="NCust"
                  name="entry.349701399"
                  class="form-control form-control-sm"
                />
                <div class="invalid-feedback">Nama Cust harus diisi!</div>
              </div>
              <div class="col-md-6">
                <label for="IdCust" class="form-label small text-muted"
                  >Cust ID</label
                >
                <input
                  type="text"
                  id="IdCust"
                  name="entry.1285711467"
                  class="form-control form-control-sm"
                />
                <div class="invalid-feedback">Cust ID harus diisi!</div>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label for="pic" class="form-label small text-muted"
                  >PIC Input</label
                >
                <input
                  type="text"
                  id="pic"
                  name="entry.1383050238"
                  class="form-control form-control-sm"
                  required
                />
                <div class="invalid-feedback">PIC harus diisi!</div>
              </div>
              <div class="col-md-6">
                <label for="NoKwn" class="form-label small text-muted"
                  >No Kawan Internal</label
                >
                <input
                  type="text"
                  id="NoKwn"
                  name="entry.1372652565"
                  class="form-control form-control-sm"
                  required
                />
                <div class="invalid-feedback">No Kawan harus diisi!</div>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label for="IdPolo" class="form-label small text-muted"
                  >Task ID Polo</label
                >
                <input
                  type="text"
                  id="IdPolo"
                  name="entry.163739172"
                  class="form-control form-control-sm"
                />
                <div class="invalid-feedback">Task ID Polo harus diisi!</div>
              </div>
              <div class="col-md-6">
                <label for="NoApp" class="form-label small text-muted"
                  >No APP</label
                >
                <input
                  type="text"
                  id="NoApp"
                  name="entry.66506618"
                  class="form-control form-control-sm"
                />
                <div class="invalid-feedback">No APP harus diisi!</div>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label for="NoOdrn" class="form-label small text-muted"
                  >No Odrn</label
                >
                <input
                  type="text"
                  id="NoOdrn"
                  name="entry.996527903"
                  class="form-control form-control-sm"
                />
                <div class="invalid-feedback">No Odrn harus diisi!</div>
              </div>
              <div class="col-md-6">
                <label for="reportDate" class="form-label small text-muted"
                  >Tanggal Lapor</label
                >
                <input
                  type="date"
                  id="reportDate"
                  name="entry.YOUR_GOOGLE_FORM_ENTRY_ID_FOR_REPORT_DATE"
                  class="form-control form-control-sm"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label for="contactPerson" class="form-label small text-muted"
                  >Contact Person</label
                >
                <input
                  type="text"
                  id="contactPerson"
                  name="entry.YOUR_GOOGLE_FORM_ENTRY_ID_FOR_CONTACT_PERSON"
                  class="form-control form-control-sm"
                />
              </div>
              <div class="col-md-6">
                <label for="contactNumber" class="form-label small text-muted"
                  >No. Telepon Contact Person</label
                >
                <input
                  type="tel"
                  id="contactNumber"
                  name="entry.YOUR_GOOGLE_FORM_ENTRY_ID_FOR_CONTACT_NUMBER"
                  class="form-control form-control-sm"
                />
              </div>
            </div>

            <div class="mb-2">
              <label for="issue" class="form-label small text-muted"
                >Issue</label
              >
              <textarea
                id="issue"
                name="entry.902491819"
                class="form-control form-control-sm"
                rows="8"
                required
              ></textarea>
              <div class="invalid-feedback">Issue harus diisi!</div>
            </div>

            <div class="mb-2">
              <label for="resolution" class="form-label small text-muted"
                >Resolusi / Tindak Lanjut</label
              >
              <textarea
                id="resolution"
                name="entry.YOUR_GOOGLE_FORM_ENTRY_ID_FOR_RESOLUTION"
                class="form-control form-control-sm"
                rows="5"
              ></textarea>
            </div>

            <div class="mb-3">
              <label for="fileUpload" class="form-label small text-muted"
                >Upload Foto/Video</label
              >
              <input
                type="file"
                id="fileUpload"
                name="entry.YOUR_GOOGLE_FORM_ENTRY_ID_FOR_FILE_UPLOAD"
                class="form-control form-control-sm"
                accept="image/*,video/*"
                multiple
              />
              <div class="form-text small text-muted">
                Max file size: 10MB. Accepted formats: images (jpg, png, gif),
                videos (mp4, mov).
              </div>
            </div>

            <div class="mb-2">
              <button
                type="submit"
                id="submitButton"
                class="btn btn-primary btn-sm"
              >
                Submit
              </button>
              <button
                type="button"
                class="btn btn-secondary btn-sm"
                onclick="window.location.reload()"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.2/dist/sweetalert2.all.min.js"></script>
    <script>
      // Ambil data dari file region.json dan isi dropdown
      // Fungsi untuk memuat dropdown Region dan Cabang
      function loadRegionData() {
        fetch("region.json") // Pastikan path JSON sesuai dengan lokasi file Anda
          .then((response) => response.json())
          .then((data) => {
            // Dapatkan elemen select untuk region dan cabang
            const regionSelect = document.getElementById("region");
            const cabangSelect = document.getElementById("cabang");

            // Clear existing options
            regionSelect.innerHTML =
              '<option value="">-- Pilih Region --</option>';
            cabangSelect.innerHTML =
              '<option value="">-- Pilih Cabang --</option>';

            // Menambahkan option untuk region
            const regions = [...new Set(data.map((item) => item.REGION_NAME))]; // Mengambil region yang unik
            regions.forEach((region) => {
              const option = document.createElement("option");
              option.value = region;
              option.textContent = region;
              regionSelect.appendChild(option);
            });

            // Menambahkan event listener untuk mengubah cabang saat region dipilih
            regionSelect.addEventListener("change", function () {
              const selectedRegion = regionSelect.value;
              if (selectedRegion) {
                // Menampilkan cabang berdasarkan region yang dipilih
                const filteredCabangs = data.filter(
                  (item) => item.REGION_NAME === selectedRegion
                );
                cabangSelect.innerHTML =
                  '<option value="">-- Pilih Cabang --</option>'; // Clear existing options
                filteredCabangs.forEach((item) => {
                  const option = document.createElement("option");
                  option.value = item.COMP_OFFICE_NAME;
                  option.textContent = item.COMP_OFFICE_NAME;
                  cabangSelect.appendChild(option);
                });
              }
            });
          })
          .catch((error) => {
            console.error("Error fetching region data:", error);
          });
      }

      // Fungsi untuk validasi dan set required fields
      function updateRequiredFields(errorSystem) {
        // Hapus tanda '*' dari semua label sebelum menambahkan yang baru
        const labels = document.querySelectorAll("label");
        labels.forEach((label) => {
          const star = label.querySelector(".text-danger");
          if (star) {
            star.remove();
          }
          // Also remove 'required' attribute and invalid-feedback display
          const input = document.getElementById(label.getAttribute('for'));
          if (input) {
            input.removeAttribute('required');
            input.classList.remove('is-invalid');
            const invalidFeedback = input.nextElementSibling;
            if (invalidFeedback && invalidFeedback.classList.contains('invalid-feedback')) {
              invalidFeedback.style.display = 'none';
            }
          }
        });

        // Add '*' and 'required' attribute based on errorSystem selection
        const fieldsToValidate = {};

        if (errorSystem === "ki") {
          fieldsToValidate.brand = true;
          fieldsToValidate.region = true;
          fieldsToValidate.cabang = true;
          fieldsToValidate.NCust = true;
          fieldsToValidate.pic = true;
          fieldsToValidate.NoKwn = true;
          fieldsToValidate.issue = true;
        } else if (errorSystem === "mss" || errorSystem === "wise") {
          fieldsToValidate.region = true;
          fieldsToValidate.cabang = true;
          fieldsToValidate.NCust = true;
          fieldsToValidate.pic = true;
          fieldsToValidate.NoKwn = true;
          fieldsToValidate.issue = true;
          fieldsToValidate.IdPolo = true;
        } else if (errorSystem === "login") {
          fieldsToValidate.region = true;
          fieldsToValidate.cabang = true;
          fieldsToValidate.pic = true;
          fieldsToValidate.issue = true;
        }

        // Apply required attributes and '*' to labels
        for (const fieldId in fieldsToValidate) {
          const label = document.querySelector(`label[for="${fieldId}"]`);
          const input = document.getElementById(fieldId);
          if (label && input) {
            label.innerHTML += ' <span class="text-danger">*</span>';
            input.setAttribute('required', 'required');
          }
        }
      }

      // Event listener for form submission
      document
        .getElementById("faqForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          // Validate all fields that are currently marked as required
          let allFieldsValid = true;
          const form = this;
          const requiredInputs = form.querySelectorAll('[required]');

          requiredInputs.forEach(input => {
            if (!input.value.trim()) {
              input.classList.add('is-invalid');
              allFieldsValid = false;
            } else {
              input.classList.remove('is-invalid');
            }
          });

          if (!allFieldsValid) {
            Swal.fire(
              "Error",
              "Harap lengkapi semua field yang wajib diisi!",
              "error"
            );
            return; // Stop form submission if validation fails
          }

          const errorSystem = document.getElementById("errorSystem").value;
          const brand = document.getElementById("brand").value;

          // Determine Google Form link based on Brand
          let googleFormLink = "";
          if (brand === "nb") {
            googleFormLink =
              "https://docs.google.com/forms/d/e/1FAIpQLSdAIIAXXpbDmdO8qtWnyAgutCopPTGDhL5-tprvCKts1yZG0w/formResponse";
          } else if (brand === "mas") {
            googleFormLink =
              "https://docs.google.com/forms/d/e/1FAIpQLSeICODvzS46C_yN3W7G2WPq9QnN5FAZcj_Cm1KiDu52akapuA/formResponse";
          } else if (brand === "mtr") {
            googleFormLink =
              "https://docs.google.com/forms/d/e/1FAIpQLSdnVEYF8LUO_irXpkrQSBKWIG__fh3tw4ClkqtNwFfKB2SB2Q/formResponse";
          } else if (brand === "mbl") {
            googleFormLink =
              "https://docs.google.com/forms/d/e/1FAIpQLSeUfH1Y4ct2KJXm6dVIvb8yO44qWGfJpVAP9M-TFSgrg2PDzQ/formResponse";
          } else {
            Swal.fire("Error", "Pilih brand yang valid!", "error");
            return;
          }

          form.action = googleFormLink;
          form.method = "POST";

          // IMPORTANT: File uploads to Google Forms directly from a client-side form
          // are not straightforward. The `fileUpload` field will likely NOT work
          // as expected for direct upload. You generally need a backend or Google Apps Script
          // to handle file uploads and then submit the file's Google Drive URL to the form.
          // For this example, the form will submit, but the file data itself won't be sent.

          form.submit();

          Swal.fire({
            title: "Mengirim...",
            text: "Mohon tunggu sebentar.",
            allowOutsideClick: false,
            didOpen: () => {
              Swal.showLoading();
            },
          });

          // Simulate success after a delay (replace with actual form submission success handling)
          setTimeout(function () {
            Swal.fire(
              "Berhasil!",
              "Formulir berhasil dikirim.",
              "success"
            ).then(() => {
              form.reset(); // Reset the form after successful submission
              // Optionally, reload region data if needed
              loadRegionData();
              // Reset required fields based on initial state or default value
              updateRequiredFields(document.getElementById("errorSystem").value);
            });
          }, 2000); // Simulate 2-second submission time
        });

      // Load region data when the page loads
      document.addEventListener("DOMContentLoaded", function () {
        loadRegionData();
        // Initialize required fields based on the default or initial errorSystem value
        updateRequiredFields(document.getElementById("errorSystem").value);
      });

      // Event listener for errorSystem dropdown
      document
        .getElementById("errorSystem")
        .addEventListener("change", function () {
          updateRequiredFields(this.value);
        });

      // Add event listeners for input validity to show/hide invalid feedback
      document.querySelectorAll('.form-control, .form-select').forEach(input => {
        input.addEventListener('input', () => {
          if (input.checkValidity()) {
            input.classList.remove('is-invalid');
          }
        });
        input.addEventListener('change', () => { // For selects
          if (input.checkValidity()) {
            input.classList.remove('is-invalid');
          }
        });
      });
    </script>
  </body>
</html>
