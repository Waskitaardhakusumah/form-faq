<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FAQ - WOM Finance</title>
    <link rel="icon" href="wom-finance.jpg" type="image/png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.2/dist/sweetalert2.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <div class="container py-3">
      <h1 class="mb-4 text-center">FAQ - WOM Finance</h1>
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0 small">Pilih FAQ</h5>
        </div>
        <div class="card-body">
          <div class="mb-3 text-end">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-toggle="modal"
              data-bs-target="#searchModal"
            >
              Cari FAQ
            </button>
          </div>
          <form>
            <div class="mb-3">
              <label for="sistem" class="form-label small text-muted"
                >Sistem</label
              >
              <select id="sistem" class="form-select form-select-sm small">
                <option value="">-- Pilih Sistem --</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="feature" class="form-label small text-muted"
                >Feature</label
              >
              <select
                id="feature"
                class="form-select form-select-sm small"
                disabled
              >
                <option value="">-- Pilih Feature --</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="kendala" class="form-label small text-muted"
                >Kendala</label
              >
              <select
                id="kendala"
                class="form-select form-select-sm small"
                disabled
              >
                <option value="">-- Pilih Kendala --</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="solusi" class="form-label small text-muted"
                >Solusi</label
              >
              <textarea
                id="solusi"
                class="form-control form-control-sm small"
                rows="5"
                readonly
              ></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label small text-muted"
                >Apakah solusi sudah berhasil?</label
              >
              <div>
                <button
                  type="button"
                  class="btn btn-success me-2"
                  id="doneBtn"
                  disabled
                >
                  Done
                </button>
                <button
                  type="button"
                  class="btn btn-danger"
                  id="notDoneBtn"
                  disabled
                >
                  Not Done
                </button>
              </div>
            </div>
            <div id="googleFormLink" class="mt-3 d-none">
              <p>Silakan isi Form untuk melaporkan kendala Anda:</p>
              <a href="#" class="btn btn-primary" id="toggleReportForm"
                >Isi Form</a
              >
            </div>
            <div id="reportFormContainer" class="mt-4 d-none">
              <h4 class="mb-3 text-center">Form FAQ - WOM Finance</h4>
              <form id="reportForm">
                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="brand" class="form-label">Brand</label>
                    <select id="brand" class="form-select" name="entry.brand" required>
                      <option value="">-- Pilih Brand --</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label for="errorSistem" class="form-label">Error Sistem</label>
                    <select id="errorSistem" class="form-select" name="entry.errorSistem" required>
                      <option value="">-- Pilih Error Sistem --</option>
                    </select>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="region" class="form-label">Region</label>
                    <select id="region" class="form-select" name="entry.region" required>
                      <option value="">-- Pilih Region --</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label for="cabang" class="form-label">Cabang</label>
                    <select id="cabang" class="form-select" name="entry.cabang" required>
                      <option value="">-- Pilih Cabang --</option>
                    </select>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="namaCust" class="form-label">Nama Cust</label>
                    <input
                      type="text"
                      id="namaCust"
                      class="form-control"
                      name="entry.namaCust"
                      placeholder="Masukkan Nama Customer"
                      required
                    />
                  </div>
                  <div class="col-md-6">
                    <label for="custID" class="form-label">Cust ID</label>
                    <input
                      type="text"
                      id="custID"
                      class="form-control"
                      name="entry.custID"
                      placeholder="Masukkan Cust ID"
                    />
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="picInput" class="form-label">PIC Input</label>
                    <input
                      type="text"
                      id="picInput"
                      class="form-control"
                      name="entry.picInput"
                      placeholder="Masukkan Nama PIC"
                      required
                    />
                  </div>
                  <div class="col-md-6">
                    <label for="noKawanInternal" class="form-label">No Kawan Internal</label>
                    <input
                      type="text"
                      id="noKawanInternal"
                      class="form-control"
                      name="entry.noKawanInternal"
                      placeholder="Masukkan No Kawan Internal"
                    />
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="taskIDPolo" class="form-label">Task ID Polo</label>
                    <input
                      type="text"
                      id="taskIDPolo"
                      class="form-control"
                      name="entry.taskIDPolo"
                      placeholder="Masukkan Task ID Polo"
                    />
                  </div>
                  <div class="col-md-6">
                    <label for="noAPP" class="form-label">No APP</label>
                    <input
                      type="text"
                      id="noAPP"
                      class="form-control"
                      name="entry.noAPP"
                      placeholder="Masukkan No APP"
                    />
                  </div>
                </div>

                <div class="mb-3">
                  <label for="noOdr" class="form-label">No Odr</label>
                  <input
                    type="text"
                    id="noOdr"
                    class="form-control"
                    name="entry.noOdr"
                    placeholder="Masukkan No Odr"
                  />
                </div>

                <div class="mb-3">
                  <label for="issue" class="form-label">Issue</label>
                  <textarea
                    id="issue"
                    class="form-control"
                    rows="4"
                    name="entry.issue"
                    placeholder="Jelaskan masalahnya secara detail"
                    required
                  ></textarea>
                </div>

                <div class="d-flex justify-content-end">
                  <button type="button" class="btn btn-secondary me-2" id="cancelReportForm">Cancel</button>
                  <button type="submit" class="btn btn-primary">Submit</button>
                </div>
              </form>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="searchModal"
      tabindex="-1"
      aria-labelledby="searchModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="searchModalLabel">Cari FAQ</h5>
            <button
              type="button"
              class="btn-close"
              id="btnClose"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="searchForm">
              <div class="row g-3">
                <div class="col-md-3">
                  <label for="searchSistem" class="form-label">Sistem</label>
                  <input
                    type="text"
                    id="searchSistem"
                    class="form-control"
                    placeholder="Cari Sistem"
                  />
                </div>
                <div class="col-md-3">
                  <label for="searchFeature" class="form-label">Feature</label>
                  <input
                    type="text"
                    id="searchFeature"
                    class="form-control"
                    placeholder="Cari Feature"
                  />
                </div>
                <div class="col-md-3">
                  <label for="searchKendala" class="form-label">Kendala</label>
                  <input
                    type="text"
                    id="searchKendala"
                    class="form-control"
                    placeholder="Cari Kendala"
                  />
                </div>
              </div>
              <div class="mt-3 text-end">
                <button
                  type="button"
                  id="clearBtn"
                  class="btn btn-secondary me-2"
                >
                  Clear
                </button>
                <button type="button" id="searchBtn" class="btn btn-primary">
                  Cari
                </button>
              </div>
            </form>
            <div class="mt-4">
              <div class="table-responsive">
                <table class="table table-bordered table-striped table-hover">
                  <thead>
                    <tr>
                      <th class="small text-muted">Sistem</th>
                      <th class="small text-muted">Feature</th>
                      <th class="small text-muted">Kendala</th>
                    </tr>
                  </thead>
                  <tbody id="searchResults">
                    <tr>
                      <td colspan="3" class="text-center small text-muted">
                        Tidak ada hasil.
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <nav aria-label="Table Pagination">
                <ul
                  class="pagination justify-content-center"
                  id="paginationControls"
                >
                  </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="solutionModal"
      tabindex="-1"
      aria-labelledby="solutionModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="solutionModalLabel">Solusi</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body" id="solutionContent">
            </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhyGkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.2/dist/sweetalert2.all.min.js"></script>
    <script>
      let faqData = [];
      let currentPage = 1;
      const rowsPerPage = 5; // Number of rows per page

      const sistemSelect = document.getElementById("sistem");
      const featureSelect = document.getElementById("feature");
      const kendalaSelect = document.getElementById("kendala");
      const solusiTextarea = document.getElementById("solusi");
      const doneBtn = document.getElementById("doneBtn");
      const notDoneBtn = document.getElementById("notDoneBtn");
      const googleFormLinkDiv = document.getElementById("googleFormLink");
      const searchResults = document.getElementById("searchResults");
      const paginationControls = document.getElementById("paginationControls");

      // Elements for the new report form
      const toggleReportFormBtn = document.getElementById("toggleReportForm");
      const reportFormContainer = document.getElementById("reportFormContainer");
      const reportForm = document.getElementById("reportForm");
      const cancelReportFormBtn = document.getElementById("cancelReportForm");

      // Dropdown elements for the report form
      const brandSelect = document.getElementById("brand");
      const errorSistemSelect = document.getElementById("errorSistem");
      const regionSelect = document.getElementById("region");
      const cabangSelect = document.getElementById("cabang");

      // Dummy data for the report form dropdowns (replace with actual data/API calls if needed)
      const reportFormDropdownData = {
        brands: ["Reguler", "MasKu", "MotorKu", "Mobilku"],
        errorSistems: ["KI", "MSS", "WISE", "Login"],
        regions: ["BANTEN", "JAWA BARAT", "JABODEBEK", "JATENGSEL", "JATIM BALI", "JATENGUT", "KALIMANTAN", "SULAWESI", "SUMBAGSEL", "SUMBAGUT"],
        cabangs: {
          "BANTEN": [""Tangerang 1 Gading Serpong",
    "Tangerang Selatan 3 Pondok Aren",
    "Tangerang 4 Tigaraksa",
    "Gudang Serang",
    "BU BANTEN",
    "Tangerang 2 Cisauk",
    "Mauk",
    "Ciputat",
    "BALARAJA",
    "Ciledug",
    "Cikupa",
    "Serang",
    "Tangerang 5 Karawaci",
    "Tangerang 6 Teluk Naga",
    "Tangerang 7 Cipondoh",
    "Parung - Tangerang Selatan 2 Pamulang",
    "Tangerang Selatan 2 Pamulang",
    "Khasanah BSD",
    "Tangerang 3 Rajeg",
    "Khasanah Map Center Ciputat",
    "Gudang Pondok Pinang",
    "Ciruas - Serang",
    "Rangkasbitung"],
          "JAWA BARAT": ["Jatibarang", "BU JaBar", "Bandung 3 Setiabudi", "Cirebon", "Purwakarta", "Tasikmalaya", "Kandanghaur - Jatibarang", "Bandung 1 Regol", "Bandung 4 Ujung Berung", "Sumedang", "Kuningan", "Cianjur", "Garut", "Bandung 2 Soreang", "Sukabumi", "CIMAHI", "Gudang Tasikmalaya", "Majalengka", "Ciamis-Tasikmalaya", "Gudang Sukabumi", "Gudang Bandung", "Gudang Jatibarang", "Gudang Purwakarta", "Gudang Sumedang", "Garut"],
          "JABODEBEK": ["BU JABODEBEK", "Jakarta Utara 2 Penjaringan", "Gudang Jati Asih", "Bekasi 1 Bekasi Barat", "Gudang Wanaherang", "Jakarta Pusat", "Jakarta Selatan 1 Pasar Minggu", "Bogor", "Cibinong", "Jakarta Selatan 2 Kebayoran Lama", "Karawang", "Bekasi 2 Tambun Selatan", "Jakarta Utara 1 Cilincing", "Leuwiliang", "Jakarta Barat 2 Kebon Jeruk", "Daan Mogot", "Cikarang", "Bogor 4 Jonggol", "Depok", "Cileungsi", "Joglo - Daan Mogot", "Jakarta Timur 1 Duren Sawit", "Jakarta Timur 2 Cipayung", "Bekasi 4 Jatiasih", "Bekasi 5 Harapan Indah", "Pancoran Mas - Depok", "Gudang Jakarta"],
          "JATENGSEL": ["BU Jateng Selatan", "Cilacap 1 Cilacap Utara", "Solo", "Cilacap 2 Sidareja", "Banyumas 1 Ajibarang", "Magelang", "Kebumen 2 Gombong", "Klaten", "Yogyakarta", "Gunungkidul Wonosari", "Muntilan - Magelang", "Purwokerto", "Wonogiri", "Banjarnegara", "Purbalingga", "Boyolali", "Wonosobo", "Sleman", "Gudang Yogyakarta", "Cilacap 3 Majenang", "Purworejo", "Kebumen 1 Kebumen", "Sragen", "Gudang Purwokerto", "Gudang Cilacap", "Gudang Wonogiri", "Gudang Kebumen", "Gudang Wonosobo", "Gudang Solo", "Bantul", "Sukoharjo - Solo"],
          "JATIM BALI": ["Gudang Madiun", "BU JATIM BNT", "Surabaya 2 Sukomanunggal", "Surabaya 1 Sukolilo", "Sidoarjo 2 Krian", "Surabaya 5 Rungkut", "Pasuruan", "Kediri", "Blitar", "Madiun", "Mataram", "Sidoarjo 1 Sidoarjo", "Ponorogo", "Malang 2 Kepanjen", "Malang 1 Blimbing", "Banyuwangi", "Ngawi", "Jombang", "Gresik", "Magetan", "Tulungagung", "Mojokerto 2 Mojosari", "Lamongan", "Bojonegoro", "Tabanan", "Tuban", "Denpasar", "Gudang Surabaya", "Gudang Malang", "Gudang Kediri", "Sidoarjo 3 Waru", "Nganjuk", "Mojokerto", "Gudang Jombang", "ROGOJAMPI", "Singosari - Malang 1 Blimbing", "Gudang Bojonegoro", "Surabaya 3 Wiyung", "Genteng", "Gudang Banyuwangi", "Tambaksari - Surabaya 1 Sukolilo", "Kertosono - Nganjuk", "Srengat - Blitar", "Kupang", "Caruban - Madiun", "Gudang Denpasar", "Gudang Mataram", "Gudang Pasuruan", "Gudang Mojokerto"],
          "JATENGUT": [ "BU Jateng Utara", "Brebes 1 Wanasari", "Brebes 2 Bumiayu", "Pekalongan 1 Wiradesa", "Jepara", "Semarang 2 Ungaran Barat", "Tegal 2 Slawi", "Pemalang 2 Randudongkal", "Kudus", "Tegal 1 Dukuh Turi", "Pemalang 1 Pemalang", "Ngaliyan - Semarang 1 Semarang Selatan", "Semarang 1 Semarang Selatan", "Kendal", "Salatiga", "Purwodadi", "Gudang Semarang", "Gudang Tegal", "Gudang Kudus", "Gudang Pekalongan", "Pekalongan 2 Kajen", "Ambarawa - Semarang 2 Ungaran Barat", "Gudang Salatiga", "Purwodadi"],
          "KALIMANTAN": ["BU Kalimantan",
    "Samarinda",
    "Balikpapan",
    "Bontang",
    "Banjarbaru",
    "Pangkalan Bun",
    "Paser",
    "Banjarmasin",
    "Berau",
    "Tenggarong",
    "Sampit",
    "Palangkaraya",
    "Gudang Samarinda",
    "Gudang Banjarmasin",
    "Gudang Berau"],
          "SULAWESI": ["Mamuju", "BU SULAWESI", "Gowa", "Bulukumba", "Palu", "Gorontalo", "Makassar 1 Panakkukang", "Makassar 2 Biringkanaya", "Pare-Pare", "Airmadidi - Manado", "KENDARI", "Manado", "Palopo", "PINRANG", "Kotamobagu", "Bitung", "Pohuwato-Marisa", "Gudang Palopo", "Gudang Palu", "PANGKEP", "Gudang Makasar", "Gudang Pare-Pare", "Isimu - Gorontalo", "Gudang Gorontalo", "Bitung", "Kotamobagu"],
          "SUMBAGSEL": ["BU SumbagSel",
    "Tugu Mulyo",
    "Pangkalpinang",
    "Palembang 2 Bukit Lama",
    "Tanjung Jabung Barat",
    "Lampung 2 Pringsewu",
    "Bengkulu",
    "Jambi",
    "Lampung Tengah",
    "Lampung 1 Tanjung Karang Pusat",
    "Tembesi",
    "Palembang 1 Ilir Timur Satu",
    "Kayu Agung",
    "Baturaja",
    "Prabumulih",
    "Muara Enim",
    "Lahat",
    "Tebo",
    "Kuala Tungkal",
    "Metro",
    "Lubuk Linggau",
    "Betung",
    "Jakabaring - Palembang",
    "Jatiagung - Lampung",
    "Musi Banyuasin",
    "Gudang Jambi",
    "Gudang Lampung",
    "Gudang Palembang",
    "Gudang Bengkulu",
    "Gudang Prabumulih",
    "Kuala Tungkal"],
          "SUMBAGUT": ["Medan 2 Medan Selayang",
    "Padang",
    "Pekanbaru 1 Marpoyan Damai",
    "Air Molek",
    "Pematang Siantar",
    "Karo",
    "BU SumbagUt",
    "Medan 1 Medan Timur",
    "Binjai",
    "Bagan Batu",
    "Toba",
    "Pekanbaru 2 Tenayan Raya",
    "Duri",
    "Batam",
    "Langkat 1 Stabat",
    "Kerinci",
    "BATU AJI",
    "Rantau Prapat",
    "Lubuk Pakam",
    "Tebing Tinggi",
    "Langkat 2 Pangkalan Brandan",
    "Gudang Medan",
    "Dumai",
    "Tanjung Pinang",
    "Panam - Pekanbaru 1 Marpoyan Damai",
    "Gudang Batam",
    "Gudang Padang",
    "Gudang Pekan Baru",
    "Rantau Prapat"],
        },
      };

      // Functions to populate the report form dropdowns
      function populateReportDropdown(selectElement, values, defaultText = "-- Pilih --") {
        selectElement.innerHTML = `<option value="">${defaultText}</option>`;
        values.forEach((value) => {
          const option = document.createElement("option");
          option.value = value;
          option.textContent = value;
          selectElement.appendChild(option);
        });
      }

      function initializeReportFormDropdowns() {
        populateReportDropdown(brandSelect, reportFormDropdownData.brands, "-- Pilih Brand --");
        populateReportDropdown(errorSistemSelect, reportFormDropdownData.errorSistems, "-- Pilih Error Sistem --");
        populateReportDropdown(regionSelect, reportFormDropdownData.regions, "-- Pilih Region --");

        regionSelect.addEventListener("change", () => {
          const selectedRegion = regionSelect.value;
          const cabangs = reportFormDropdownData.cabangs[selectedRegion] || [];
          populateReportDropdown(cabangSelect, cabangs, "-- Pilih Cabang --");
          cabangSelect.disabled = !selectedRegion; // Disable cabang if no region selected
        });

        // Initially disable cabang select
        cabangSelect.disabled = true;
      }


      // Fungsi untuk menampilkan indikator loading
      function showLoading(message = "Loading...") {
        Swal.fire({
          title: message,
          allowOutsideClick: false,
          didOpen: () => {
            Swal.showLoading();
          },
        });
      }

      // Fungsi untuk menyembunyikan indikator loading dengan durasi tambahan
      function hideLoading(delay = 1000) {
        setTimeout(() => {
          Swal.close();
        }, delay);
      }

      // Load JSON and initialize dropdowns
      fetch("output.json")
        .then((response) => response.json())
        .then((data) => {
          faqData = data;
          initializeDropdowns();
          initializeReportFormDropdowns(); // Initialize report form dropdowns
        })
        .catch((error) => {
          console.error("Error loading JSON data:", error);
          Swal.fire(
            "Error",
            "Gagal memuat data FAQ. Silakan refresh halaman.",
            "error"
          );
        });

      // Initialize Dropdowns for main FAQ section
      function initializeDropdowns() {
        populateDropdown(sistemSelect, getUniqueValues("Sistem"));
        sistemSelect.addEventListener("change", handleSistemChange);
        featureSelect.addEventListener("change", handleFeatureChange);
        kendalaSelect.addEventListener("change", handleKendalaChange);
      }

      // Populate dropdown with unique values
      function populateDropdown(selectElement, values, defaultText = "-- Pilih --") {
        selectElement.innerHTML = `<option value="" class="small text-muted">${defaultText}</option>`;
        values.forEach((value) => {
          const option = document.createElement("option");
          option.value = value;
          option.textContent = value;
          option.classList.add("small", "text-muted");
          selectElement.appendChild(option);
        });
      }

      // Get unique values for a column
      function getUniqueValues(column) {
        return [...new Set(faqData.map((item) => item[column]))];
      }

      // Handle Sistem Change
      function handleSistemChange() {
        if (!sistemSelect.value) {
          populateDropdown(featureSelect, [], "-- Pilih Feature --");
          populateDropdown(kendalaSelect, [], "-- Pilih Kendala --");
          solusiTextarea.value = "";
          featureSelect.disabled = true;
          kendalaSelect.disabled = true;
          doneBtn.disabled = true;
          notDoneBtn.disabled = true;
          googleFormLinkDiv.classList.add("d-none");
          reportFormContainer.classList.add("d-none"); // Sembunyikan form pelaporan
          return;
        }

        featureSelect.disabled = false;
        const filteredFeatures = [
          ...new Set(
            faqData
              .filter((item) => item.Sistem === sistemSelect.value)
              .map((item) => item.Feature)
          ),
        ];
        populateDropdown(featureSelect, filteredFeatures, "-- Pilih Feature --");

        populateDropdown(kendalaSelect, [], "-- Pilih Kendala --");
        kendalaSelect.disabled = true;
        solusiTextarea.value = "";
        doneBtn.disabled = true;
        notDoneBtn.disabled = true;
        googleFormLinkDiv.classList.add("d-none");
        reportFormContainer.classList.add("d-none"); // Sembunyikan form pelaporan
      }

      // Handle Feature Change
      function handleFeatureChange() {
        if (!featureSelect.value) {
          populateDropdown(kendalaSelect, [], "-- Pilih Kendala --");
          solusiTextarea.value = "";
          kendalaSelect.disabled = true;
          doneBtn.disabled = true;
          notDoneBtn.disabled = true;
          googleFormLinkDiv.classList.add("d-none");
          reportFormContainer.classList.add("d-none"); // Sembunyikan form pelaporan
          return;
        }

        kendalaSelect.disabled = false;
        const filteredKendala = [
          ...new Set(
            faqData
              .filter(
                (item) =>
                  item.Sistem === sistemSelect.value &&
                  item.Feature === featureSelect.value
              )
              .map((item) => item.Kendala)
          ),
        ];
        populateDropdown(kendalaSelect, filteredKendala, "-- Pilih Kendala --");

        solusiTextarea.value = "";
        doneBtn.disabled = true;
        notDoneBtn.disabled = true;
        googleFormLinkDiv.classList.add("d-none");
        reportFormContainer.classList.add("d-none"); // Sembunyikan form pelaporan
      }

      // Handle Kendala Change
      function handleKendalaChange() {
        if (!kendalaSelect.value) {
          solusiTextarea.value = "";
          doneBtn.disabled = true;
          notDoneBtn.disabled = true;
          googleFormLinkDiv.classList.add("d-none");
          reportFormContainer.classList.add("d-none"); // Sembunyikan form pelaporan
          return;
        }

        const solusi = faqData.find(
          (item) =>
            item.Sistem === sistemSelect.value &&
            item.Feature === featureSelect.value &&
            item.Kendala === kendalaSelect.value
        )?.Solusi;

        solusiTextarea.value = solusi || "";
        doneBtn.disabled = !solusi;
        notDoneBtn.disabled = !solusi;
        googleFormLinkDiv.classList.add("d-none");
        reportFormContainer.classList.add("d-none"); // Sembunyikan form pelaporan
      }

      // Handle Done Button
      doneBtn.addEventListener("click", () => {
        googleFormLinkDiv.classList.add("d-none");
        reportFormContainer.classList.add("d-none");
        Swal.fire({
          icon: "success",
          title: "Berhasil",
          text: "Solusi berhasil diselesaikan!",
        });
      });

      // Handle Not Done Button
      notDoneBtn.addEventListener("click", () => {
        googleFormLinkDiv.classList.remove("d-none");
        Swal.fire({
          icon: "info",
          title: "Belum Selesai",
          text: "Silakan isi Form untuk melaporkan kendala Anda.",
        });
      });

      // Function to display paginated results
      function displayPaginatedResults(results, page) {
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        const paginatedResults = results.slice(start, end);

        searchResults.innerHTML = "";
        if (paginatedResults.length === 0) {
          searchResults.innerHTML =
            '<tr><td colspan="3" class="text-center small">Tidak ada hasil.</td></tr>';
          return;
        }

        paginatedResults.forEach((item) => {
          const row = document.createElement("tr");

          row.innerHTML = `
        <td class="text-wrap small text-muted" style="max-width: 150px; cursor: pointer;" data-column="Sistem">${item.Sistem}</td>
        <td class="text-wrap small text-muted" style="max-width: 150px; cursor: pointer;" data-column="Feature">${item.Feature}</td>
        <td class="text-wrap small text-muted" style="max-width: 150px; cursor: pointer;" data-column="Kendala">${item.Kendala}</td>
      `;

          row.querySelectorAll("td").forEach((cell) => {
            cell.addEventListener("click", () =>
              showSolutionModal(item.Solusi)
            );
          });

          searchResults.appendChild(row);
        });
      }

      // Function to render pagination controls
      function renderPaginationControls(results) {
        const totalPages = Math.ceil(results.length / rowsPerPage);
        paginationControls.innerHTML = "";

        const prevButton = document.createElement("li");
        prevButton.className = `page-item ${
          currentPage === 1 ? "disabled" : ""
        }`;
        prevButton.innerHTML = `<a class="page-link" href="#" aria-label="Previous">&laquo;</a>`;
        prevButton.addEventListener("click", (e) => {
          e.preventDefault();
          if (currentPage > 1) {
            currentPage--;
            updatePagination(results);
          }
        });
        paginationControls.appendChild(prevButton);

        for (let i = 1; i <= totalPages; i++) {
          const pageItem = document.createElement("li");
          pageItem.className = `page-item ${i === currentPage ? "active" : ""}`;
          pageItem.innerHTML = `<a class="page-link" href="#">${i}</a>`;
          pageItem.addEventListener("click", (e) => {
            e.preventDefault();
            currentPage = i;
            updatePagination(results);
          });
          paginationControls.appendChild(pageItem);
        }

        const nextButton = document.createElement("li");
        nextButton.className = `page-item ${
          currentPage === totalPages ? "disabled" : ""
        }`;
        nextButton.innerHTML = `<a class="page-link" href="#" aria-label="Next">&raquo;</a>`;
        nextButton.addEventListener("click", (e) => {
          e.preventDefault();
          if (currentPage < totalPages) {
            currentPage++;
            updatePagination(results);
          }
        });
        paginationControls.appendChild(nextButton);
      }

      // Function to update table and pagination controls
      function updatePagination(results) {
        displayPaginatedResults(results, currentPage);
        renderPaginationControls(results);
      }

      // Function to show the solution modal
      function showSolutionModal(solution) {
        const solutionModal = new bootstrap.Modal(
          document.getElementById("solutionModal")
        );
        document.getElementById("solutionContent").textContent =
          solution || "Solusi tidak tersedia.";
        solutionModal.show();
      }

      // Handle Search Button
      document.getElementById("searchBtn").addEventListener("click", () => {
        const searchSistem = document
          .getElementById("searchSistem")
          .value.trim();
        const searchFeature = document
          .getElementById("searchFeature")
          .value.trim();
        const searchKendala = document
          .getElementById("searchKendala")
          .value.trim();

        if (!searchSistem && !searchFeature && !searchKendala) {
          Swal.fire({
            icon: "warning",
            title: "Peringatan",
            text: "Harap isi minimal satu kolom pencarian!",
          });
          return;
        }

        showLoading("Mencari data...");

        const results = faqData.filter((item) => {
          return (
            (searchSistem === "" ||
              item.Sistem.toLowerCase().includes(searchSistem.toLowerCase())) &&
            (searchFeature === "" ||
              item.Feature.toLowerCase().includes(
                searchFeature.toLowerCase()
              )) &&
            (searchKendala === "" ||
              item.Kendala.toLowerCase().includes(searchKendala.toLowerCase()))
          );
        });

        hideLoading(1500);
        currentPage = 1;
        updatePagination(results);
      });

      // Handle Clear Button
      document.getElementById("clearBtn").addEventListener("click", () => {
        showLoading("Membersihkan data...");
        document.getElementById("searchSistem").value = "";
        document.getElementById("searchFeature").value = "";
        document.getElementById("searchKendala").value = "";

        searchResults.innerHTML =
          '<tr><td colspan="3" class="text-center small">Tidak ada hasil.</td></tr>';

        paginationControls.innerHTML = "";
        hideLoading(1000);
      });

      // Handle Close Button (modal search)
      document.getElementById("btnClose").addEventListener("click", () => {
        document.getElementById("searchSistem").value = "";
        document.getElementById("searchFeature").value = "";
        document.getElementById("searchKendala").value = "";

        searchResults.innerHTML =
          '<tr><td colspan="3" class="text-center small">Tidak ada hasil.</td></tr>';

        paginationControls.innerHTML = "";
      });

      // --- New event listeners for the detailed report form ---

      // Event listener for the "Isi Form" button (toggleReportForm)
      toggleReportFormBtn.addEventListener("click", (e) => {
        e.preventDefault();
        reportFormContainer.classList.toggle("d-none");
        if (!reportFormContainer.classList.contains("d-none")) {
            // If the form is shown, ensure dropdowns are initialized
            initializeReportFormDropdowns();
        }
      });

      // Event listener for the "Cancel" button on the report form
      cancelReportFormBtn.addEventListener("click", () => {
        reportForm.reset(); // Reset the form fields
        reportFormContainer.classList.add("d-none"); // Hide the form
        // Optional: clear validation states
        Array.from(reportForm.elements).forEach((element) => {
            element.classList.remove("is-invalid");
        });
        // Reset dropdowns for the report form
        initializeReportFormDropdowns();
      });

      // Event listener for the submission of the detailed report form
      reportForm.addEventListener("submit", function (e) {
        e.preventDefault();

        const form = e.target;
        let isValid = true;

        // Reset Bootstrap validation states
        Array.from(form.elements).forEach((element) => {
          element.classList.remove("is-invalid");
        });

        // Validate required fields
        Array.from(form.elements).forEach((element) => {
          if (element.hasAttribute("required") && !element.value.trim()) {
            element.classList.add("is-invalid");
            isValid = false;
          }
        });

        if (!isValid) {
          Swal.fire(
            "Error",
            "Harap lengkapi semua field yang wajib diisi pada form laporan kendala!",
            "error"
          );
          return;
        }

        showLoading("Mengirim laporan...");

        // Replace with your actual Google Form's formResponse URL for this new form
        const googleFormReportLink = "YOUR_NEW_GOOGLE_FORM_REPORT_LINK_HERE"; // <<<--- GANTI INI!

        const formData = new FormData(form);
        const params = new URLSearchParams();

        // Append all form fields with their respective Google Forms entry IDs
        // You MUST find these entry IDs from your Google Form (Preview -> Inspect element on input fields -> look for 'name' attribute)
        // Example: entry.123456789 for Brand, entry.987654321 for Error Sistem, etc.
        // I'm using dummy names like 'entry.brand', 'entry.errorSistem' here, you need to replace them.
        params.append("entry.brand", formData.get("entry.brand"));
        params.append("entry.errorSistem", formData.get("entry.errorSistem"));
        params.append("entry.region", formData.get("entry.region"));
        params.append("entry.cabang", formData.get("entry.cabang"));
        params.append("entry.namaCust", formData.get("entry.namaCust"));
        params.append("entry.custID", formData.get("entry.custID"));
        params.append("entry.picInput", formData.get("entry.picInput"));
        params.append("entry.noKawanInternal", formData.get("entry.noKawanInternal"));
        params.append("entry.taskIDPolo", formData.get("entry.taskIDPolo"));
        params.append("entry.noAPP", formData.get("entry.noAPP"));
        params.append("entry.noOdr", formData.get("entry.noOdr"));
        params.append("entry.issue", formData.get("entry.issue"));

        // Optionally, append selected FAQ details if relevant to this report form
        params.append("entry.faqSistem", sistemSelect.value); // Example: entry.faqSistem, replace with actual ID
        params.append("entry.faqFeature", featureSelect.value); // Example: entry.faqFeature, replace with actual ID
        params.append("entry.faqKendala", kendalaSelect.value); // Example: entry.faqKendala, replace with actual ID
        params.append("entry.faqSolusi", solusiTextarea.value); // Example: entry.faqSolusi, replace with actual ID


        fetch(googleFormReportLink, {
          method: "POST",
          mode: "no-cors", // Important for cross-origin Google Form submission
          body: params,
        })
          .then(() => {
            hideLoading(1000);
            Swal.fire(
              "Terima Kasih!",
              "Laporan kendala Anda telah berhasil dikirim.",
              "success"
            ).then(() => {
              form.reset(); // Reset the report form
              reportFormContainer.classList.add("d-none"); // Hide the report form
              // Reset dropdowns for the report form after submission
              initializeReportFormDropdowns();

              // Optional: reset main FAQ dropdowns if desired after report submission
              // sistemSelect.value = "";
              // handleSistemChange();
            });
          })
          .catch((error) => {
            console.error("Error submitting report form:", error);
            hideLoading(1000);
            Swal.fire(
              "Gagal!",
              "Terjadi kesalahan saat mengirim laporan. Silakan coba lagi.",
              "error"
            );
          });
      });
    </script>
  </body>
</html>
